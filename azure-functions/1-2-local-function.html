<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Local Function - Azure Trainings</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../src/css/custom.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Trainings</li><li class="chapter-item expanded "><a href="../azure-functions/index.html"><strong aria-hidden="true">1.</strong> Azure Functions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../azure-functions/1-1-local-function-app.html"><strong aria-hidden="true">1.1.</strong> Local Function App</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-2-local-function.html" class="active"><strong aria-hidden="true">1.2.</strong> Local Function</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-3-azure-function-app.html"><strong aria-hidden="true">1.3.</strong> Azure Function App</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-4-deploying-local-to-azure.html"><strong aria-hidden="true">1.4.</strong> Deploying your App to Azure</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-5-working-with-app-settings.html"><strong aria-hidden="true">1.5.</strong> Working with App Settings</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-6-adding-health-checks.html"><strong aria-hidden="true">1.6.</strong> Adding health checks</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-7-working-with-logs.html"><strong aria-hidden="true">1.7.</strong> Working with Logs</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-8-basic-function-security.html"><strong aria-hidden="true">1.8.</strong> Basic Function Security</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-9-cleanup.html"><strong aria-hidden="true">1.9.</strong> Cleanup</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Azure Trainings</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/chdalski/azure-training/tree/main" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/chdalski/azure-training/edit/main/src/azure-functions/1-2-local-function.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="local-function"><a class="header" href="#local-function">Local Function</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>In this chapter we will create a local function, look at its details and then start and call it.</p>
<p>Make sure you have created a <a href="./1-2-local-function.html">Local Function App</a>.</p>
<p>Commands in this chapter are to be executed in the <em>Function App</em> root directory unless stated otherwise.</p>
<h2 id="add-a-function-to-our-function-app"><a class="header" href="#add-a-function-to-our-function-app">Add a function to our Function App</a></h2>
<p>A function is the primary concept in Azure Functions.</p>
<p>A function contains two important pieces:</p>
<ul>
<li>your code, which can be written in a variety of languages</li>
<li>its config file called <em>function.json</em></li>
</ul>
<p>For scripting languages, you must provide the config file yourself.
For compiled languages, the config file is generated automatically from annotations in your code.</p>
<p>We can add a new one to our <em>Function App</em> with the Azure Functions Core Tools – take a look at the <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-core-tools-reference">command reference</a> for insights on the parameters:</p>
<pre><code class="language-shell">func new --name greetings --authlevel anonymous --template &quot;HTTP Trigger&quot;
</code></pre>
<p>That's it!
We've successfully added a new function 🎉!</p>
<p>When listing the files in our <em>Function App</em> root directory, you'll see a new directory, named like our function (&quot;greetings&quot;), which contains all the files for the function itself.
So if you want to delete a function, it's enough to remove the directory.</p>
<blockquote>
<p>Note: We won't go into the details of different authorization levels yet. For now use <em>anonymous</em> when you add new functions.</p>
</blockquote>
<h3 id="the-functionjson"><a class="header" href="#the-functionjson">The <em>function.json</em></a></h3>
<p>The <em>function.json</em> file defines the function's trigger, bindings, and other configuration settings.
The runtime uses this config file to determine the events to monitor and how to pass data into and return data from a function execution.</p>
<h4 id="triggers"><a class="header" href="#triggers">Triggers</a></h4>
<p><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings">Triggers</a> cause a function to run.
They define how a function is invoked and a function must have exactly one trigger.
Triggers have associated data, which is often provided as the payload of the function.</p>
<p>In our case we created an HTTP Trigger, so our function is triggered via HTTP requests.</p>
<h4 id="bindings"><a class="header" href="#bindings">Bindings</a></h4>
<p><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings">Binding</a> to a function are a way of declaratively connecting another resource to the function.
Bindings may be connected as input bindings, output bindings, or both.
Data from bindings is provided to the function as parameters.</p>
<p>Bindings are optional and a function might have one or multiple input and/or output bindings.</p>
<h4 id="details"><a class="header" href="#details">Details</a></h4>
<p>Browsing the contents of our <em>function.json</em> file reveals we currently have two bindings.</p>
<details>
  <summary>Sample function.json</summary>
<pre><code class="language-json">{
  &quot;bindings&quot;: [
    {
      &quot;authLevel&quot;: &quot;Anonymous&quot;,
      &quot;type&quot;: &quot;httpTrigger&quot;,
      &quot;direction&quot;: &quot;in&quot;,
      &quot;name&quot;: &quot;req&quot;,
      &quot;methods&quot;: [&quot;get&quot;, &quot;post&quot;]
    },
    {
      &quot;type&quot;: &quot;http&quot;,
      &quot;direction&quot;: &quot;out&quot;,
      &quot;name&quot;: &quot;res&quot;
    }
  ],
  &quot;scriptFile&quot;: &quot;../dist/greetings/index.js&quot;
}
</code></pre>
</details>
<ul>
<li>An <code>in</code>-binding (input) named <code>req</code> of type <code>httpTrigger</code></li>
<li>An <code>out</code>-binding (output) named <code>res</code> of type <code>http</code></li>
</ul>
<h3 id="the-indexts"><a class="header" href="#the-indexts">The index.ts</a></h3>
<p>The <em>index.ts</em> was created for us from the HTTP Trigger template we specified when adding the new function.
It contains a sample function implementation with which we'll play around in a moment.</p>
<p>But first take a closer look at the constant called httpTrigger:</p>
<pre><code class="language-typescript">const httpTrigger: AzureFunction = async function (context: Context, req: HttpRequest): Promise&lt;void&gt; {...}
</code></pre>
<p>There are some noteworthy things here:</p>
<p>First, the function is asynchronous.
Review the language-specific details if that has any implications for you (i. e. <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-reference-node#contextdone-method">TypeScript</a> or <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-reference-python#async">Python</a>)</p>
<p>Second, the function expects two parameters:</p>
<ul>
<li>The first one (<code>context</code>) is language-specific, but other languages have equivalents for it. It's passed to every function and is used for receiving and sending binding data, logging, and communicating with the runtime.
<ul>
<li>The structure of the context object <strong>depends on</strong> the selected trigger and bindings.</li>
</ul>
</li>
<li>The second one (<code>req</code>) is the http request object.
<ul>
<li>The name of the request object <strong>must match</strong> the name defined for the input binding in your <code>function.json</code></li>
</ul>
</li>
</ul>
<h2 id="start-the-function"><a class="header" href="#start-the-function">Start the function</a></h2>
<p>Now we can finally start our new function with:</p>
<pre><code class="language-shell">npx tsc &amp;&amp; func start
</code></pre>
<p>The command triggers the TypeScript compiler and starts the function afterwards.</p>
<p>The output contains details on the Core Tools version and the runtime version, but more importantly we get an overview over the functions we provide, their URL and the accepted http methods.</p>
<details>
  <summary>Sample output</summary>
<pre><code class="language-text">Azure Functions Core Tools
Core Tools Version:       4.0.4915 Commit hash: N/A  (64-bit)
Function Runtime Version: 4.14.0.19631


Functions:

        greetings: [GET,POST] http://localhost:7071/api/greetings

For detailed output, run func with --verbose flag.
</code></pre>
</details>
<h3 id="shutdown-the-function"><a class="header" href="#shutdown-the-function">Shutdown the function</a></h3>
<p>To shutdown your Function App, press <code>ctrl+c</code>.</p>
<h3 id="verbose-flag"><a class="header" href="#verbose-flag">Verbose flag</a></h3>
<p>The <em>verbose flag</em> can be helpful if you want to get insights what the runtime is doing under the hood.</p>
<p>Give it a try and start the function with the <em>verbose flag</em>:</p>
<pre><code class="language-shell">npx tsc &amp;&amp; func start --verbose
</code></pre>
<blockquote>
<p>Note: The verbose flag toggles only the runtime log level, but not the log level of your functions.
We'll learn how to toggle the function log levels later, though.</p>
</blockquote>
<h2 id="calling-the-function"><a class="header" href="#calling-the-function">Calling the function</a></h2>
<p>After starting the function app you can easily test it with any Rest client or open it in your <a href="http://localhost:7071/api/greetings">browser</a>:</p>
<pre><code class="language-shell">curl http://localhost:7071/api/greetings
</code></pre>
<p>Or with parameters (<a href="http://localhost:7071/api/greetings?name=codecentric">browser</a>):</p>
<pre><code class="language-shell">curl http://localhost:7071/api/greetings -d '{&quot;name&quot;:&quot;codecentric&quot;}'
</code></pre>
<h2 id="quiz"><a class="header" href="#quiz"><span class="quiz">Quiz</span></a></h2>
<details>
  <summary>What file specifies the accepted http methods for a function of type HTTP Trigger?</summary>
<p>Every function has it's dedicated settings file called <em>function.json</em>.</p>
</details>
<br/>
<details>
  <summary>What error code does the Function send if you called it with an unspecified http method?</summary>
<p>It responds with <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404">404 Not Found</a>.</p>
<p>Test command:</p>
<pre><code class="language-shell">curl -X OPTION http://localhost:7071/api/greetings -v
</code></pre>
</details>
<br/>
<details>
  <summary>Can you see error messages in the Function console output? Does the output change if you use the verbose flag to start the Function?</summary>
<p>The console output does indeed not show unsuccessful attempts to call the function.
That changes, however, if we restart the Function with the verbose flag.</p>
<p>Test command:</p>
<pre><code class="language-shell">curl -X OPTION http://localhost:7071/api/greetings -v
</code></pre>
</details>
<br/>
<details>
  <summary>Are there function bindings for Kafka? If so, which runtime version is supported? Are in, out or both binding types supported?</summary>
<p>Take a look at the <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings#supported-bindings">documentation</a>.</p>
<p>As you can see Kafka is supported since runtime version 2.x.
Furthermore, only output bindings are supported.</p>
</details>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../azure-functions/1-1-local-function-app.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../azure-functions/1-3-azure-function-app.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../azure-functions/1-1-local-function-app.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../azure-functions/1-3-azure-function-app.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
