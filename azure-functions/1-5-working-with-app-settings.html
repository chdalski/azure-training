<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Working with App Settings - Azure Trainings</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../src/css/custom.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Trainings</li><li class="chapter-item expanded "><a href="../azure-functions/index.html"><strong aria-hidden="true">1.</strong> Azure Functions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../azure-functions/1-1-local-function-app.html"><strong aria-hidden="true">1.1.</strong> Local Function App</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-2-local-function.html"><strong aria-hidden="true">1.2.</strong> Local Function</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-3-azure-function-app.html"><strong aria-hidden="true">1.3.</strong> Azure Function App</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-4-deploying-local-to-azure.html"><strong aria-hidden="true">1.4.</strong> Deploying your App to Azure</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-5-working-with-app-settings.html" class="active"><strong aria-hidden="true">1.5.</strong> Working with App Settings</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-6-adding-health-checks.html"><strong aria-hidden="true">1.6.</strong> Adding health checks</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-7-working-with-logs.html"><strong aria-hidden="true">1.7.</strong> Working with Logs</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-8-basic-function-security.html"><strong aria-hidden="true">1.8.</strong> Basic Function Security</a></li><li class="chapter-item expanded "><a href="../azure-functions/1-9-cleanup.html"><strong aria-hidden="true">1.9.</strong> Cleanup</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Azure Trainings</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/chdalski/azure-training/tree/main" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/chdalski/azure-training/edit/main/src/azure-functions/1-5-working-with-app-settings.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="working-with-app-settings"><a class="header" href="#working-with-app-settings">Working with App Settings</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>In the previous step we deployed our Function App to Azure.
We'll now take a look at the <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-app-settings">App settings</a>.</p>
<p>Application settings in a function app contain configuration options that affect all functions for that function app.
By default, you store connection strings and secrets used by your function app and bindings as application settings and access them as environment variables.
However, secrets not needed by Azure to be stored as application settings should rather be stored in <a href="https://learn.microsoft.com/en-us/azure/key-vault/general/">Azure KeyVault</a> instead of the application settings.</p>
<p>Commands in this chapter are to be executed in the <em>Function App</em> root directory unless stated otherwise.</p>
<h2 id="fetch-the-settings-from-azure"><a class="header" href="#fetch-the-settings-from-azure">Fetch the settings from Azure</a></h2>
<p>We learned in chapter <a href="./1-1-local-function-app.html#the-localsettingsjson">2.1 Local Function App</a> that our local Function App settings are stored in a file called <em>local.settings.json</em>.
When we created our local Function App, the file was added with the minimal set of entries the runtime needs to work properly.</p>
<p>Take a look at your local settings first:</p>
<pre><code class="language-shell">func settings list
</code></pre>
<p>And compare it to the settings in Azure:</p>
<pre><code class="language-shell">az functionapp config appsettings list --resource-group rg-functions-demo --name &lt;APP_NAME&gt;
</code></pre>
<p>As you can see, there are already more settings in Azure, even if we just created the app and deployed it once.
For example, the settings for <a href="./1-3-azure-function-app.html#creating-the-demo-resources">Application Insights</a> were automatically set when we created the resources via Bicep.</p>
<p>To fetch the settings from Azure we can execute:</p>
<pre><code class="language-shell">func azure functionapp fetch-app-settings &lt;APP_NAME&gt;
</code></pre>
<p>After executing the command, the <em>local.settings.json</em> is updated and matches the settings in Azure.
If the file is, for whatever reason, not found on your machine, you can still execute the command and the file will be created for you.</p>
<h2 id="encrypting-and-decrypting"><a class="header" href="#encrypting-and-decrypting">Encrypting and decrypting</a></h2>
<p>App settings and connection strings are stored encrypted in Azure.
They're decrypted only before being injected into your app's process memory when the app starts.</p>
<p>The function runtime offers the possibility to encrypt and decrypt your local settings as well, and as these settings contain sensitive information (connection strings, secrets and so on) the simple advice is to encrypt them and only decrypt them if needed.</p>
<p>However, secrets not needed by Azure to be stored as application settings should rather be stored in <a href="https://learn.microsoft.com/en-us/azure/key-vault/general/">Azure KeyVault</a> instead of the application settings.</p>
<p>Encrypt the settings with:</p>
<pre><code class="language-shell">func settings encrypt
</code></pre>
<p>Decrypt the settings with:</p>
<pre><code class="language-shell">func settings decrypt
</code></pre>
<h2 id="use-app-settings-in-functions"><a class="header" href="#use-app-settings-in-functions">Use app settings in functions</a></h2>
<p>Application settings can be accessed in functions like every other environment variable and are accessible in every function in the same Function App.
Let's add a new function that returns all environment variables when it's called.</p>
<p>Add the function (use authlevel <code>function</code>):</p>
<pre><code class="language-shell">func new --name settings --authlevel function --template &quot;HTTP Trigger&quot;
</code></pre>
<p>Update the code to return all environment variables (snippet):</p>
<pre><code class="language-typescript">const httpTrigger: AzureFunction = async function (
  context: Context,
  req: HttpRequest
): Promise&lt;void&gt; {
  context.res = {
    // this will return all environment variables
    body: process.env,
  };
};
</code></pre>
<p>Now start the Function App and call the settings endpoint.
Interestingly you'll see not just the settings from the <em>local.settings.json</em> but also quite a lot that the runtime added by itself.
Don't use environment variables not configured in <em>local.settings.json</em> in your function, however, because they aren't guaranteed.</p>
<blockquote>
<p>Note: As application settings contain sensitive information you usually wouldn't return them like we did here and just use what's necessary where it's necessary in your functions.</p>
</blockquote>
<h3 id="-task-optional-deploy-the-function-app"><a class="header" href="#-task-optional-deploy-the-function-app"><span class="task">🛠 TASK (optional):</span> Deploy the Function App</a></h3>
<p>Deploy the function app like you did in the <a href="./1-4-deploying-local-to-azure.html#deploying-the-function-app">previous chapter</a> and call the new settings endpoint.
You'll see that you won't get any output, but instead a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401">401 Unauthorized</a> response.
That's because we configured the authorization level to be <em>function</em>.</p>
<p>We'll learn how to call that function in a later chapter.
For now we can just leave it like that as we made sure nobody besides us can call it.</p>
<blockquote>
<p>Note: If you missed to create the function with authorization level set to <code>function</code>, just update the <code>authLevel</code> to <code>function</code> in the <em>function.json</em> and redeploy the Function App.</p>
</blockquote>
<h2 id="quiz"><a class="header" href="#quiz"><span class="quiz">Quiz</span></a></h2>
<details>
  <summary>Can the functions still be started if you delete the <span class="italic">local.settings.json?</span></summary>
<p>The Function App can still be executed, even though you'll get a warning:</p>
<pre><code class="language-text">Can't determine project language from files. Please use one of [--csharp, --javascript, --typescript, --java, --python, --powershell, --custom]
</code></pre>
<p>Using the specific language parameter the warning disappears:</p>
<pre><code class="language-shell">npx tsc &amp;&amp; func start --typescript
</code></pre>
<p>But only the basic environment variables will be available like that.
Refetch them from Azure before you continue.</p>
</details>
<br/>
<details>
  <summary>What alternate secrets store should you consider for sensitive information instead of application settings?</summary>
<p><a href="https://learn.microsoft.com/en-us/azure/key-vault/general/">Azure KeyVault</a> is a secure alternative if your secrets are not required to be stored as application settings by Azure.</p>
</details>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../azure-functions/1-4-deploying-local-to-azure.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../azure-functions/1-6-adding-health-checks.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../azure-functions/1-4-deploying-local-to-azure.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../azure-functions/1-6-adding-health-checks.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
